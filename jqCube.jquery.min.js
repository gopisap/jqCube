(function(a){a.fn.cube=function(t){function b(a,b){return"undefined"!==typeof a?a:b}function A(t){d=t.length||d||400;e=t.width||e||400;f=t.height||f||400;g=t.center||g||[300,300];h=t.lightDirection?[[t.lightDirection[0]],[t.lightDirection[1]],[t.lightDirection[2]]]:h||[[1],[1],[1]];i=b(t.hue,b(i,128));u=b(t.opacity,100*b(u,1))/100;v=b(t.saturation,b(v,50));l=b(t.minLuminosity,b(l,50));n=t.maxLuminosity||n||85;n<l&&(n=l);B=n-l;m=1e3/(t.frameRate||1e3/m||20);w=t.secondsPerRotation||w||5;r=(t.initialPosition?t.initialPosition[0]:r/(2*Math.PI)||0)*Math.PI/2;s=(t.initialPosition?t.initialPosition[1]:s/(2*Math.PI)||0)*Math.PI/2;x=b(t.horizontalCoefficient,b(x,1));y=b(t.verticalCoeficcient,b(y,1));j=t.element?a(t.element):o;C=j.find(".front");D=j.find(".back");E=j.find(".left");F=j.find(".right");G=j.find(".bottom");H=j.find(".top");k=t.hasOwnProperty("animate")?t.animate:b(k,true);t=c=c||0;p();c=t;k&&(clearInterval(q),q=setInterval(p,m))}function I(){clearInterval(q);k=false;return o}function J(){clearInterval(q);q=setInterval(p,m);k=true;return o}function z(e,b,d){var d=d||m,b=false!==b?1:false,g=k,j=c;I();var a=b*d,i=1e3/d;b||(a=1);var l=e[0]*Math.PI/2/a,f=e[1]*Math.PI/2/a;(function h(b){b<a?(r+=l,s+=f,p(),c=j,setTimeout(function(){h(b+1)},i)):g&&J()})(0);return o}function K(a,b,c){z([-a,0],b,c)}function L(a,b,c){z([0,-a],b,c)}function p(){function o(k,h,i,n,m,g,f,j,c,o,r){var j=t(j,c),g=p(j,q(g)),f=p(j,q(f)),c=g,e=f,d=Array(3);d[0]=Array(1);d[0][0]=c[1][0]*e[2][0]-c[2][0]*e[1][0];d[1]=Array(1);d[1][0]=c[2][0]*e[0][0]-c[0][0]*e[2][0];d[2]=Array(1);d[2][0]=c[0][0]*e[1][0]-c[1][0]*e[0][0];directionZ=d;c=[[1],[0],[0]];e=[[0],[1],[0]];d=[[0],[0],[1]];surfaceMatrix=[[b(c,g),b(c,f),b(c,directionZ)],[b(e,g),b(e,f),b(e,directionZ)],[b(d,g),b(d,f),b(d,directionZ)]];i=p(j,i);g=l+B*b(q(r),q(directionZ));0<directionZ[2][0]?(f=h[0]+i[0][0]-m/2,h=h[1]-i[1][0]-n/2,k.attr("style","height: "+n+"px; width: "+m+"px;background-color: hsla("+o+","+v+"%,"+g+"%,"+u+");-webkit-transform: matrix("+a(surfaceMatrix[0][0],5)+","+-a(surfaceMatrix[1][0],5)+","+-a(surfaceMatrix[0][1],5)+","+a(surfaceMatrix[1][1],5)+",0,0);-moz-transform: matrix("+a(surfaceMatrix[0][0],5)+","+-a(surfaceMatrix[1][0],5)+","+-a(surfaceMatrix[0][1],5)+","+a(surfaceMatrix[1][1],5)+",0,0);-ms-transform: matrix("+a(surfaceMatrix[0][0],5)+","+-a(surfaceMatrix[1][0],5)+","+-a(surfaceMatrix[0][1],5)+","+a(surfaceMatrix[1][1],5)+",0,0);-o-transform: matrix("+a(surfaceMatrix[0][0],5)+","+-a(surfaceMatrix[1][0],5)+","+-a(surfaceMatrix[0][1],5)+","+a(surfaceMatrix[1][1],5)+",0,0);position: absolute; left: "+f+"px; top: "+h+"px;")):k.css({position:"absolute",left:"-9999px"})}function t(a,b){var d=[[1,0,0],[0,Math.cos(a),-Math.sin(a)],[0,Math.sin(a),Math.cos(a)]],c=[[Math.cos(b),0,-Math.sin(b)],[0,1,0],[Math.sin(b),0,Math.cos(b)]];return p(d,c)}function p(f,c){for(var e=Array(f.length),a=0;a<f.length;a++){e[a]=Array(c[0].length);for(var b=0;b<c[0].length;b++)for(var d=e[a][b]=0;d<c.length;d++)e[a][b]+=f[a][d]*c[d][b]}return e}function b(b,d){for(var c=0,a=0;a<b.length;a++)c+=b[a][0]*d[a][0];return c}function q(b){magnitude=0;for(var c=Array(b.length),a=0;a<b.length;a++)magnitude+=b[a][0]*b[a][0];magnitude=Math.sqrt(magnitude);for(a=0;a<b.length;a++)c[a]=Array(1),c[a][0]=b[a][0]/magnitude;return c}function a(b,a){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)}var j=r+x*(c%(2*Math.PI)),n=s+y*(c%(2*Math.PI));k&&(c+=4*Math.PI/(m*w));t(n,j);o(C,g,[[0],[0],[d/2]],f,e,[[1],[0],[0]],[[0],[1],[0]],n,j,i,h);o(F,g,[[e/2],[0],[0]],f,d,[[0],[0],[-1]],[[0],[1],[0]],n,j,i,h);o(H,g,[[0],[f/2],[0]],d,e,[[1],[0],[0]],[[0],[0],[-1]],n,j,i,h);o(D,g,[[0],[0],[-d/2]],f,e,[[-1],[0],[0]],[[0],[1],[0]],n,j,i,h);o(E,g,[[-e/2],[0],[0]],f,d,[[0],[0],[1]],[[0],[1],[0]],n,j,i,h);o(G,g,[[0],[-f/2],[0]],d,e,[[1],[0],[0]],[[0],[0],[1]],n,j,i,h)}var t=t||{},o=this,d,e,f,g,h,i,u,v,l,n,B,m,w,r,s,x,y,j,C,D,E,F,G,H,k,q,c,M={front:[0,0],left:[-1,0],right:[1,0],back:[2,0],top:[0,1],bottom:[0,-1]};A(t);this.setOption=function(a,b){t[a]=b;A(t);return o};this.startAnimation=J;this.stopAnimation=I;this.move=z;this.moveRight=K;this.moveLeft=function(a,b,c){return K(-a,b,c)};this.moveUp=L;this.moveDown=function(a,b,c){return L(-a,b,c)};this.setPosition=function(a){M[a]&&(a=M[a]);r=a[0]*Math.PI/2;s=a[1]*Math.PI/2;c=0;p()};return this}})(jQuery)